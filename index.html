<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="PNG画像を国土地理院の地形図上に重ね合わせるジオリファレンスツール">
    <meta name="keywords" content="地形図, ジオリファレンス, 画像重ね合わせ, 国土地理院, マップ">
    <meta name="author" content="GeoReferencer">
    <title>GeoReferencer - 画像重ね合わせツール</title>

    <!-- セキュリティとパフォーマンスのためのメタタグ -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    
    <!-- ファビコンのリクエストを抑制して404エラーを防ぐ -->
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">

    <!-- 外部CDNリソースの事前接続でパフォーマンス向上 -->
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    
    <!-- Leaflet.js の CSS と JS を読み込み -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="">
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>

    <!-- SheetJS (XLSX) ライブラリ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Firebase SDK (v9.22.0 Compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <!-- アプリケーション固有のスタイルシート -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- メイン地図コンテナ -->
    <main id="map" role="main" aria-label="国土地理院地形図"></main>

    <!-- メッセージ表示エリア -->
    <div id="messageArea" class="message-area" style="display: none;"></div>

    <!-- アプリケーション制御パネル -->
    <aside class="overlay-controls" role="complementary" aria-label="画像重ね合わせツール">
        <!-- 画像重ね合わせセクション -->
        <section id="geoReferencerPanel" class="editor-panel" aria-labelledby="geo-ref-title">
            <h2 id="geo-ref-title" class="visually-hidden">画像重ね合わせツール</h2>
            
            <!-- ポイントGPS読み込み -->
            <div class="load-file-container">
                <button id="loadFileBtn" title="GPS座標データ（Excel形式）を読み込みます" class="leaflet-bar leaflet-control">ポイントGPSの読み込み</button>
                <div class="count-display">
                    <input type="text" id="gpsPointCount" readonly value="0" class="count-field">
                    <span class="unit-label">個</span>
                </div>
            </div>
            
            <!-- ファイル入力 -->
            <input type="file" id="gpsExcelInput" accept=".xlsx" style="display: none;">
            <input type="file" id="imageInput" accept="image/png" style="display: none;">
            
            <!-- PNG画像読み込み -->
            <div class="json-data-counts">
                <div class="json-load-row">
                    <button id="loadPngBtn" class="load-json-button leaflet-bar leaflet-control"
                            title="PNG画像を読み込み、Firebaseから画像座標データを自動取得します">PNG画像の読み込み</button>
                    <div class="count-fields-inline">
                        <div class="count-item-inline">
                            <label>ポイント</label>
                            <div class="count-value-group">
                                <input type="text" id="pointCount" readonly value="0" class="count-field">
                                <span class="unit-label">個</span>
                            </div>
                        </div>
                        <div class="count-item-inline">
                            <label>ルート</label>
                            <div class="count-value-group">
                                <input type="text" id="routeCount" readonly value="0" class="count-field">
                                <span class="unit-label">本</span>
                            </div>
                        </div>
                        <div class="count-item-inline">
                            <label>スポット</label>
                            <div class="count-value-group">
                                <input type="text" id="spotCount" readonly value="0" class="count-field">
                                <span class="unit-label">個</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            
            <!-- 画像の重ね合わせ(ジオリファレンス)ボタン -->
            <button id="matchPointsBtn" class="leaflet-bar leaflet-control"
                    title="ポイントのマッチングと画像の重ね合わせを実行します">画像の重ね合わせ（ジオリファレンス）</button>
            
            <!-- ポイントマッチング結果表示 -->
            <div class="matching-results-container">
                <div class="matching-summary">
                    <div class="matched-count">
                        <label for="matchedPointCountField">一致するポイント数</label>
                        <div class="count-value-group">
                            <input type="text" id="matchedPointCountField" readonly value="0" class="count-field">
                            <span class="unit-label">個</span>
                        </div>
                    </div>
                </div>
                <div class="unmatched-points">
                    <label for="unmatchedPointsField">不一致ポイント</label>
                    <input type="text" id="unmatchedPointsField" readonly placeholder="マッチングしなかったポイント">
                </div>
            </div>
            


            <!-- 標高取得セクション -->
            <div class="elevation-controls">
                <button id="fetchElevationBtn" class="leaflet-bar leaflet-control"
                        title="標高未取得地点の標高を国土地理院APIから取得します">標高取得</button>
                <div class="elevation-checkboxes">
                    <div class="elevation-checkbox-item">
                        <label>
                            <input type="checkbox" id="elevationRouteCheckbox" checked>
                            ルート中間点
                        </label>
                        <div class="elevation-count-wrapper">
                            <label class="elevation-count-label">標高未取得</label>
                            <input type="text" id="elevationRouteCount" readonly value="0" class="count-field-wide">
                        </div>
                    </div>
                    <div class="elevation-checkbox-item">
                        <label>
                            <input type="checkbox" id="elevationSpotCheckbox" checked>
                            スポット
                        </label>
                        <input type="text" id="elevationSpotCount" readonly value="0" class="count-field-wide">
                    </div>
                </div>
            </div>

            <!-- GPS値保存 -->
            <button id="saveToFirebaseBtn" class="leaflet-bar leaflet-control" disabled
                    title="ジオリファレンス後のGPS変換済みデータをFirebaseに保存します">変換後のGPS値をデータベースに格納</button>

        </section>
    </aside>

    <!-- 分離したJavaScriptファイルを読み込む -->
    <!-- type="module"により、ES6モジュールとして読み込む -->
    <script type="module" src="js/app-main.js"></script>
</body>
</html>
